# Simple workflow for deploying static content to GitHub Pages
name: Cross Compile cpp for amd64 Architecture

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["master"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  # Single deploy job since we're just deploying
  codechecker:
    environment:
      name: cross-compile-cpp-amd64
    runs-on: ubuntu-latest
    steps:
      # Check YOUR project out!
      - name: "Check out repository"
        uses: actions/checkout@v2

      # Apply requirements on ubuntu
      - name: "Install requirements"
        run: |
          apt update
          apt install -y cmake:amd64 libboost-all-dev:amd64 libboost-all-dev:amd64

      # Compile for amd64
      - name: "Compile for amd64"
        run: |
          cd tool/cpp
          bash build.sh

      # Package
      - name: "Package"
        run: |
          cd tool/cpp
          mkdir -p dist/usr/bin
          cp build/src/main/main pacmon-1.0.0-amd64/usr/bin/pacmon

      # Upload the results to the CI.
      - uses: actions/upload-artifact@v2
        with:
          name: "CPP AMD64 Binary"
          path: tool/cpp/pacmon-1.0.0-amd64/usr/bin/pacmon
